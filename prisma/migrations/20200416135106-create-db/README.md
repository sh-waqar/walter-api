# Migration `20200416135106-create-db`

This migration has been generated by Waqar Ali at 4/16/2020, 1:51:06 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."accounts" (
    "balance" Decimal(65,30)  NOT NULL ,
    "color" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "currency" text  NOT NULL ,
    "id" SERIAL,
    "name" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."categories" (
    "createdAt" timestamp(3)   ,
    "expenseType" "ExpenseType" NOT NULL DEFAULT 'OUT',
    "icon" text   ,
    "id" SERIAL,
    "isVisible" boolean  NOT NULL ,
    "name" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    "userId" integer   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."labels" (
    "color" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" SERIAL,
    "name" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."records" (
    "accountId" integer  NOT NULL ,
    "amount" Decimal(65,30)  NOT NULL ,
    "categoryId" integer  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "description" text   ,
    "expenseType" "ExpenseType" NOT NULL DEFAULT 'OUT',
    "id" SERIAL,
    "timestamp" timestamp(3)  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."record_labels" (
    "id" SERIAL,
    "labelId" integer  NOT NULL ,
    "recordId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."users" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "email" text  NOT NULL ,
    "id" SERIAL,
    "name" text  NOT NULL ,
    "password" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE UNIQUE INDEX "users.email" ON "public"."users"("email")

ALTER TABLE "public"."accounts" ADD FOREIGN KEY ("userId")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."categories" ADD FOREIGN KEY ("userId")REFERENCES "public"."users"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."labels" ADD FOREIGN KEY ("userId")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."records" ADD FOREIGN KEY ("accountId")REFERENCES "public"."accounts"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."records" ADD FOREIGN KEY ("categoryId")REFERENCES "public"."categories"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."record_labels" ADD FOREIGN KEY ("labelId")REFERENCES "public"."labels"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."record_labels" ADD FOREIGN KEY ("recordId")REFERENCES "public"."records"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200416135106-create-db
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,98 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+model Account {
+  id        Int      @default(autoincrement()) @id
+  name      String
+  color     String
+  currency  String
+  balance   Float
+  records   Record[]
+  userId    Int
+  user      User     @relation(fields: [userId], references: [id])
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  @@map("accounts")
+}
+
+model Category {
+  id          Int         @default(autoincrement()) @id
+  name        String
+  icon        String?
+  isVisible   Boolean
+  expenseType ExpenseType @default(OUT)
+  records     Record[]
+  userId      Int?
+  user        User?       @relation(fields: [userId], references: [id])
+  createdAt   DateTime?
+  updatedAt   DateTime    @updatedAt
+
+  @@map("categories")
+}
+
+model Label {
+  id           Int           @default(autoincrement()) @id
+  name         String
+  color        String
+  recordLabels RecordLabel[]
+  userId       Int
+  user         User          @relation(fields: [userId], references: [id])
+  createdAt    DateTime      @default(now())
+  updatedAt    DateTime      @updatedAt
+
+  @@map("labels")
+}
+
+model Record {
+  id           Int           @default(autoincrement()) @id
+  amount       Float
+  description  String?
+  timestamp    DateTime
+  expenseType  ExpenseType   @default(OUT)
+  recordLabels RecordLabel[]
+  accountId    Int
+  categoryId   Int
+  account      Account       @relation(fields: [accountId], references: [id])
+  category     Category      @relation(fields: [categoryId], references: [id])
+  createdAt    DateTime      @default(now())
+  updatedAt    DateTime      @updatedAt
+
+  @@map("records")
+}
+
+model RecordLabel {
+  id       Int    @default(autoincrement()) @id
+  labelId  Int
+  recordId Int
+  label    Label  @relation(fields: [labelId], references: [id])
+  record   Record @relation(fields: [recordId], references: [id])
+
+  @@map("record_labels")
+}
+
+model User {
+  id         Int        @default(autoincrement()) @id
+  name       String
+  email      String     @unique
+  password   String
+  accounts   Account[]
+  categories Category[]
+  labels     Label[]
+  createdAt  DateTime   @default(now())
+  updatedAt  DateTime   @updatedAt
+
+  @@map("users")
+}
+
+enum ExpenseType {
+  IN
+  OUT
+  TRANSFER
+}
```


